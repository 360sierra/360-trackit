webpackJsonp([3],{"+nwc":function(e,t){},0:function(e,t,n){e.exports=n("nplA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"3Puz":function(e,t){},4:function(e,t){},"4Th3":function(e,t){},"7YgM":function(e,t){e.exports={name:"track-it",version:"0.4.17",description:"A simple application based on flespi.io and built with Quasar and Leaflet.js. Allows tracking different devices on the map, viewing telemetry messages for these devices.",productName:"Track it!",cordovaId:"org.cordova.quasar.app",author:"Sergei Buntsevich <sebu@gurtam.com>",private:!0,scripts:{lint:"eslint --ext .js,.vue src",dev:'node ./build.js "dev -m pwa" "flespi"',build:'node ./build.js "build -m pwa" "flespi"',dev_local:'node ./build.js "dev -m pwa" "local"',deploy:"npm run build && rm -rf deploy && mkdir deploy && cp -R dist/pwa-mat/* misc LICENSE package.json deploy && cp README.md deploy/README.md && node_modules/git-directory-deploy/bin/git-directory-deploy.sh -ddeploy -bgh-pages -rhttps://git.gurtam.net/flespi/frontend/TrackIt.git && rm -rf deploy && git push github gh-pages"},dependencies:{"flespi-io-js":"git+https://github.com/flespi-software/flespi-io-js.git",leaflet:"^1.3.1",moment:"^2.22.2",qtelemetry:"git+https://github.com/flespi-software/QTelemetry.git",qvirtualscroll:"git+https://github.com/flespi-software/QVirtualScroll.git",shelljs:"^0.8.2","vue-clipboard2":"^0.1.1","vue-i18n":"^7.8.1","vue-virtual-scroll-list":"^1.2.6"},devDependencies:{"babel-eslint":"^8.2.3",eslint:"^4.19.1","eslint-config-standard":"^11.0.0","eslint-friendly-formatter":"^3.0.0","eslint-loader":"^2.0.0","eslint-plugin-import":"^2.12.0","eslint-plugin-node":"^6.0.1","eslint-plugin-promise":"^3.8.0","eslint-plugin-standard":"^3.1.0","eslint-plugin-vue":"^4.5.0","git-directory-deploy":"^1.5.1","quasar-cli":"^0.15.20"},engines:{node:">= 8.9.0",npm:">= 5.6.0"},browserslist:["> 1%","last 2 versions","not ie <= 10"]}},JsEP:function(e,t){},MGDR:function(e,t,n){e.exports=n.p+"img/trackit.4dbf2ed.png"},N12Q:function(e,t){},R58i:function(e,t){},nplA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),o=n.n(i),s=(n("30VO"),n("/5sW")),a=n("7109");s.default.use(a.W,{components:{QLayout:a.t,QLayoutDrawer:a.u,QPageContainer:a.A,QPage:a.z,QToolbar:a.N,QToolbarTitle:a.O,QBtn:a.g,QIcon:a.m,QList:a.v,QListHeader:a.w,QItem:a.o,QItemMain:a.p,QItemSide:a.q,QItemTile:a.r,QTooltip:a.P,QResizeObservable:a.E,QModal:a.x,QSelect:a.G,QInput:a.n,QKnob:a.s,QCheckbox:a.h,QModalLayout:a.y,QAlert:a.f,QTabs:a.L,QTab:a.J,QTabPane:a.K,QToggle:a.M,QPopover:a.B,QProgress:a.C,QSpinnerGears:a.I,QWindowResizeObservable:a.Q,QDatetime:a.k,QSearch:a.F,QSlider:a.H,QField:a.l,QRange:a.D,QChip:a.i,QColorPicker:a.j},directives:{TouchPan:a.S,TouchHold:a.R},plugins:{Notify:a.e,Loading:a.c,LocalStorage:a.d,Cookies:a.a,Dialog:a.b}});n("L4dm"),n("hAPP"),n("59Iv"),n("3Puz"),n("N12Q");var r={name:"offline",data:function(){return{intervalId:0}},created:function(){var e=this;this.intervalId=setInterval(function(){e.$store.dispatch("checkConnection")},5e3)}},c=n("XyMi");var u=function(e){n("4Th3")},l={name:"App",components:{Offline:Object(c.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.offline||e.$store.state.socketOffline?n("div",{staticClass:"offline-page window-height window-width bg-light column items-center no-wrap"},[n("div",{staticClass:"offline-back"},[n("div",{staticClass:"offline-code"}),e._v(" "),n("div",{staticClass:"offline-line"},e._l(Array(20),function(t){return n("span",{key:t},[e._v("offline")])}))])]):e._e()},[],!1,u,null,null).exports}};var d=function(e){n("tHqv")},f=Object(c.a)(l,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"q-app"}},[t("router-view"),this._v(" "),t("offline",{attrs:{logo:"../statics/trackit.png"}})],1)},[],!1,d,null,null).exports,p=n("/ocq"),v=[{path:"/",component:function(){return n.e(0).then(n.bind(null,"yoYR"))},children:[{path:"devices/:devices",component:function(){return n.e(0).then(n.bind(null,"yoYR"))}}]},{path:"/login",component:function(){return n.e(1).then(n.bind(null,"P7ry"))}},{path:"/login/:token",component:function(){return n.e(1).then(n.bind(null,"P7ry"))}},{path:"/login/:token/devices/:devices",component:function(){return n.e(0).then(n.bind(null,"yoYR"))}},{path:"*",component:function(){return n.e(2).then(n.bind(null,"c5Mg"))}}];s.default.use(p.a);var h,g,m,w,k,b=new p.a({mode:"hash",base:"/",scrollBehavior:function(){return{y:0}},routes:v}),D=n("NYxO"),y=n("Gu7T"),Q=n.n(y),I=n("Xxa5"),x=n.n(I),T=n("exGp"),C=n.n(T),M=(h=C()(x.a.mark(function e(t){var n,i=this,o=t.state,a=t.commit;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a("reqStart"),e.prev=1,!o.token){e.next=7;break}return e.next=5,s.default.connector.poolDevices(function(e){a("setDevices",e)},function(e,t){a("updateDevices",{type:e,device:t})});case 5:return n=e.sent,e.abrupt("return",C()(x.a.mark(function e(){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.connector.poolDevicesStop(n);case 2:case"end":return e.stop()}},e,i)})));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),a("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return h.apply(this,arguments)}),P=(g=C()(x.a.mark(function e(t,n){t.state;var i,o,a=t.commit,r=n.data,c=n.id;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a("reqStart"),e.prev=1,e.next=4,s.default.connector.gw.postDevicesMessages(c,r);case 4:i=e.sent,(o=i.data).errors&&o.errors.forEach(function(e){a("addError",e.reason)}),a("reqSuccessful",{type:"postMessage",payload:o}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),a("reqFailed",e.t0);case 13:case"end":return e.stop()}},e,this,[[1,10]])})),function(e,t){return g.apply(this,arguments)}),L=(m=C()(x.a.mark(function e(t){var n=t.state,i=t.commit;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.default.connector.http.external.get("./statics/icons/favicon-16x16.png?_="+(new Date).getTime());case 3:200===e.sent.status&&n.offline&&i("setOfflineFlag",!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),n.offline||i("setOfflineFlag",!0);case 11:case"end":return e.stop()}},e,this,[[0,7]])})),function(e){return m.apply(this,arguments)}),O=(w=C()(x.a.mark(function e(t,n){var i,o,a,r,c=t.commit,u=t.state;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=n||u.activeDevicesID.join(","))){e.next=11;break}return e.next=4,s.default.connector.gw.getDevicesTelemetry(i);case 4:return o=e.sent,(a=o.data).errors&&P.errors.forEach(function(e){c("addError",e.reason)}),r=Math.max.apply(Math,Q()(a.result.reduce(function(e,t){return e.push(t.telemetry&&t.telemetry["position.latitude"]?Math.floor(1e3*t.telemetry["position.latitude"].ts):0),e.push(t.telemetry&&t.telemetry["position.longitude"]?Math.floor(1e3*t.telemetry["position.longitude"].ts):0),e},[]))),e.abrupt("return",r-r%864e5);case 11:return e.abrupt("return",Date.now());case 12:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)}),S=(k=C()(x.a.mark(function e(t){var n,i,o=t.commit;t.state;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.default.connector.http.auth.oauth.providers.get();case 3:n=e.sent,(i=n.data.result[0]).email=s.default.connector.httpConfig.server+(s.default.connector.httpConfig.port?":"+s.default.connector.httpConfig.port:"")+"/#/login/",o("setLoginProviders",i),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),o("reqFailed",e.t0);case 13:case"end":return e.stop()}},e,this,[[0,9]])})),function(e){return k.apply(this,arguments)}),E={poolDevices:M,postMessage:P,checkConnection:L,getLastUpdatePosition:O,getLoginProviders:S},q=n("woOf"),A=n.n(q),j=n("mvHQ"),F=n.n(j);function _(e,t){s.default.set(e,"offline",t)}function R(e){var t=a.a.get("X-Flespi-Token"),n=a.d.get.item("X-Flespi-Token");t&&n&&t===n&&a.a.remove("X-Flespi-Token"),a.d.remove("X-Flespi-Token"),s.default.connector.token="",s.default.set(e,"token","")}function N(e,t){e.hasDevicesInit&&!e.devices.filter(function(e){return e.id===t})[0].messages_ttl||(e.activeDevicesID.push(t),a.d.set("TrackIt Active Devices",e.activeDevicesID),e.hasDevicesInit&&b.push("/devices/"+e.activeDevicesID.join(",")))}function X(e,t){var n=e.activeDevicesID.indexOf(t);e.activeDevicesID.splice(n,1),a.d.set("TrackIt Active Devices",e.activeDevicesID),e.activeDevicesID.length?b.push("/devices/"+e.activeDevicesID.join(",")):b.push("/")}function z(e){e.hasDevicesInit=!0}function G(e){e.hasDevicesInit=!1,s.default.set(e,"devices",[]),s.default.set(e,"activeDevicesID",[])}function H(e,t){a.e.create({type:"negative",icon:"warning",message:""+t,timeout:1e3}),e.newNotificationCounter++,e.errors.push(t)}var V={reqStart:function(e){},reqSuccessful:function(e,t){var n=t.type,i=t.payload.result;switch(n){case"postMessage":a.e.create({message:"Post message to devices with IDs "+i+" success",type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:F()(e[n])!==F()(i)&&s.default.set(e,n,i)}},reqFailed:function(e,t){if(t.response&&t.response.status)switch(t.response.status){case 0:_(e,!0),G(e),s.default.set(e,"token","");break;case 401:R(e);break;default:t.response.data&&t.response.data.errors&&t.response.data.errors.length&&t.response.data.errors.forEach(function(t){H(e,t.reason)})}else H(e,t.message)},setToken:function(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(s.default.connector.token="FlespiToken "+n,a.d.set("X-Flespi-Token",n)):(n="",s.default.connector.token="",R(e)),s.default.set(e,"token",n)},clearToken:R,setActiveDevice:N,unsetActiveDevice:X,setDevicesInit:z,unsetDevicesInit:G,setOfflineFlag:_,updateDevices:function(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices[i]=A()(e.devices[i],t.device),!0)});break;case"deleted":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices.splice(i,1),!0)})}},setDevices:function(e,t){if(F()(e.devices)!==F()(t.data.result)&&s.default.set(e,"devices",t.data.result),!e.hasDevicesInit)if(e.activeDevicesID.length)e.activeDevicesID.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length||X(e,n)}),z(e);else{z(e);var n=a.d.get.item("TrackIt Active Devices");n&&n.length&&n.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length&&N(e,n)})}},setSocketOffline:function(e,t){s.default.set(e,"socketOffline",t)},clearNotificationCounter:function(e){e.newNotificationCounter=0},addError:H,setLoginProviders:function(e,t){s.default.set(e,"providers",t)}},Y={messages:{namespaced:!0}};s.default.use(D.a);var $=new D.a.Store({state:{providers:{},token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1,socketOffline:!1,isLoading:!1,newNotificationCounter:0,errors:[]},actions:E,mutations:V,getters:{},modules:Y}),B=n("TXmL"),J={en:{failed:"Action failed",success:"Action was successful"}},W=n("LarL"),K=n.n(W),U=n("7YgM"),Z={socketConfig:{clientId:"trackit-"+U.version+"-"+Math.random().toString(16).substr(2,8)}};-1===window.location.host.indexOf("localhost:9004")&&-1===window.location.host.indexOf("localhost:9005")&&-1===window.location.host.indexOf("localhost:7004")||(Z={httpConfig:{server:"https://localhost",port:9005},socketConfig:{server:"wss://localhost:9017",clientId:"trackit-"+U.version+"-dev-"+Math.random().toString(16).substr(2,8)}});var ee=n("wvfG"),te=n.n(ee),ne=n("v5o6"),ie=n.n(ne);s.default.config.productionTip=!1;var oe=o()({el:"#q-app",router:b,store:$},f),se=[];se.push(function(e){var t=e.app;e.Vue.use(B.a),t.i18n=new B.a({locale:"en",fallbackLocale:"en",messages:J})}),se.push(function(e){var t=e.Vue;t.config.productionTip=!1,t.use(K.a,Z),t.connector.socket.on("connect",function(){console.log("plugin")}),window&&window.addEventListener("beforeunload",function(){t.connector.socket.close(!0)})}),se.push(function(e){e.Vue.use(te.a)}),se.forEach(function(e){return e({app:oe,router:b,store:$,Vue:s.default})}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&document.addEventListener("DOMContentLoaded",function(){ie.a.attach(document.body)},!1),new s.default(oe)},tHqv:function(e,t){}},[0]);