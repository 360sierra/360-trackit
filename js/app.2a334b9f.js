(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{0:function(e,t,n){e.exports=n("2f39")},1:function(e,t){},"1d10":function(e,t,n){},2:function(e,t){},"2f39":function(e,t,n){"use strict";n.r(t);var a=n("967e"),r=n.n(a),i=(n("a481"),n("96cf"),n("fa84")),o=n.n(i),s=(n("5c7d"),n("1194"),n("7d6e"),n("e54f"),n("62f2"),n("7e6d"),n("2b0e")),c=n("b05d"),u=n("4d5a"),l=n("e359"),f=n("9404"),d=n("09e3"),p=n("9989"),v=n("65c6"),h=n("6ac5"),m=n("9c40"),g=n("0016"),b=n("1c1c"),w=n("66e5"),k=n("4074"),y=n("0170"),D=n("05c0"),x=n("3980"),Q=n("24e8"),I=n("ddd8"),O=n("27f9"),C=n("3845"),N=n("8f8e"),S=n("429b"),T=n("7460"),L=n("adad"),q=n("823b"),R=n("9564"),j=n("4e73"),E=n("58ea"),M=n("cf57"),P=n("c1d0"),_=n("8572"),A=n("7bbf"),$=n("b0476"),F=n("b498"),J=n("f09f"),H=n("eb85"),V=n("4b7e"),B=n("a370"),z=n("6a67"),G=n("714f"),K=n("7f67"),U=n("f449"),W=n("75c3"),X=n("2a19"),Y=n("f5084"),Z=n("18d6"),ee=n("a639"),te=n("436b");s["default"].use(c["a"],{config:{},components:{QLayout:u["a"],QHeader:l["a"],QDrawer:f["a"],QPageContainer:d["a"],QPage:p["a"],QToolbar:v["a"],QToolbarTitle:h["a"],QBtn:m["a"],QIcon:g["a"],QList:b["a"],QItem:w["a"],QItemSection:k["a"],QItemLabel:y["a"],QTooltip:D["a"],QResizeObserver:x["a"],QDialog:Q["a"],QSelect:I["a"],QInput:O["a"],QKnob:C["a"],QCheckbox:N["a"],QTabs:S["a"],QTab:T["a"],QTabPanels:L["a"],QTabPanel:q["a"],QToggle:R["a"],QMenu:j["a"],QCircularProgress:E["a"],QSpinnerGears:M["a"],QSlider:P["a"],QField:_["a"],QRange:A["a"],QChip:$["a"],QColor:F["a"],QCard:J["a"],QSeparator:H["a"],QCardActions:V["a"],QCardSection:B["a"],QBtnToggle:z["a"]},directives:{Ripple:G["a"],ClosePopup:K["a"],TouchHold:U["a"],TouchPan:W["a"]},plugins:{Notify:X["a"],Loading:Y["a"],LocalStorage:Z["a"],SessionStorage:ee["a"],Dialog:te["a"]}});var ne=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"q-app"}},[n("router-view"),n("offline",{attrs:{logo:"../statics/trackit.png"}})],1)},ae=[],re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.offline||e.$store.state.socketOffline?n("div",{staticClass:"offline-page window-height window-width bg-light column items-center no-wrap"},[n("div",{staticClass:"offline-back"},[n("div",{staticClass:"offline-code"}),n("div",{staticClass:"offline-line"},e._l(Array(20),(function(t){return n("span",{key:t},[e._v("offline")])})),0)])]):e._e()},ie=[],oe={name:"offline",data:function(){return{intervalId:0}},created:function(){var e=this;this.intervalId=setInterval((function(){e.$store.dispatch("checkConnection")}),5e3)}},se=oe,ce=(n("85c2"),n("2877")),ue=Object(ce["a"])(se,re,ie,!1,null,null,null),le=ue.exports,fe={name:"App",components:{Offline:le}},de=fe,pe=Object(ce["a"])(de,ne,ae,!1,null,null,null),ve=pe.exports,he=n("2f62"),me=(n("7f7f"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("4db1")),ge=n.n(me),be=n("9b02"),we=n.n(be);function ke(e){return ye.apply(this,arguments)}function ye(){return ye=o()(r.a.mark((function e(t){var n,a,i;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.state,a=t.commit,a("reqStart"),e.prev=2,!n.token){e.next=8;break}return e.next=6,s["default"].connector.poolDevices((function(e){a("setDevices",e)}),(function(e,t){a("updateDevices",{type:e,device:t})}));case 6:return i=e.sent,e.abrupt("return",o()(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s["default"].connector.poolDevicesStop(i);case 2:case"end":return e.stop()}}),e)}))));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),a("reqFailed",e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])}))),ye.apply(this,arguments)}function De(e){return xe.apply(this,arguments)}function xe(){return xe=o()(r.a.mark((function e(t){var n,a,i;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.state,a=t.commit,e.prev=1,e.next=4,s["default"].connector.http.external.get("./statics/icons/favicon-16x16.png?_=".concat((new Date).getTime()));case 4:i=e.sent,200===i.status&&n.offline&&a("setOfflineFlag",!1),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),n.offline||a("setOfflineFlag",!0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])}))),xe.apply(this,arguments)}function Qe(e,t){return Ie.apply(this,arguments)}function Ie(){return Ie=o()(r.a.mark((function e(t,n){var a,i,o,c,u,l,f,d,p;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.commit,i=t.state,o=(new Date).setHours(0,0,0,0),c=o+86399999,!i.token){e.next=17;break}if(u=n||i.activeDevicesID.join(","),!u){e.next=14;break}return e.next=7,s["default"].connector.gw.getDevicesTelemetry(u);case 7:f=e.sent,d=f.data,d.errors&&postMessage.errors.forEach((function(e){a("addError",e.reason)})),p=Math.max.apply(Math,ge()(d.result.reduce((function(e,t){return e.push(t.telemetry&&t.telemetry["position.latitude"]?Math.floor(1e3*t.telemetry["position.latitude"].ts):0),e.push(t.telemetry&&t.telemetry["position.longitude"]?Math.floor(1e3*t.telemetry["position.longitude"].ts):0),e}),[]))),l=p||Date.now(),e.next=15;break;case 14:l=Date.now();case 15:o=new Date(l).setHours(0,0,0,0),c=o+86399999;case 17:return e.abrupt("return",[o,c]);case 18:case"end":return e.stop()}}),e)}))),Ie.apply(this,arguments)}function Oe(e,t){return Ce.apply(this,arguments)}function Ce(){return Ce=o()(r.a.mark((function e(t,n){var a,i,o,c,u,l,f;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.commit,i=t.state,i.token){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,s["default"].connector.gw.getDevicesTelemetry(n);case 5:if(o=e.sent,c=o.data,c.errors&&postMessage.errors.forEach((function(e){a("addError",e.reason)})),u=c&&c.result[0]&&c.result[0].telemetry?c.result[0].telemetry:{},l=Object.keys(u),l.length){e.next=11;break}return e.abrupt("return",!1);case 11:f=l.reduce((function(e,t){return"position"===t||(e[t]=u[t].value),e}),{}),f["x-flespi-inited-by-telemetry"]=!0,a("messages/".concat(n,"/setHistoryMessages"),[f]);case 14:case"end":return e.stop()}}),e)}))),Ce.apply(this,arguments)}function Ne(e){return Se.apply(this,arguments)}function Se(){return Se=o()(r.a.mark((function e(t){var n,a,i,o,c;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.state,a=t.commit,e.prev=1,"undefined"!==typeof n.isLoading&&s["default"].set(n,"isLoading",!0),e.next=5,s["default"].connector.http.get("/auth/regions");case 5:i=e.sent,o=we()(i,"data.result",[]),c=null,o=o.reduce((function(e,t){return t.default&&(c=t),e[t.name]=t,e}),{}),c&&a("setCurrentRegion",c),a("setRegions",o),e.next=17;break;case 13:e.prev=13,e.t0=e["catch"](1),a("reqFailed",e.t0),"undefined"!==typeof n.isLoading&&s["default"].set(n,"isLoading",!1);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Se.apply(this,arguments)}function Te(e,t){return Le.apply(this,arguments)}function Le(){return Le=o()(r.a.mark((function e(t,n){var a,i,o,c;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.state,i=t.commit,o=n.region,c=n.token,e.prev=2,"undefined"!==typeof a.isLoading&&s["default"].set(a,"isLoading",!0),a.regions){e.next=7;break}return e.next=7,Ne({state:a,commit:i});case 7:o&&i("setCurrentRegion",a.regions[o]),s["default"].prototype.$flespiServer=a.currentRegion.rest,s["default"].prototype.$flespiSocketServer="wss://".concat(a.currentRegion["mqtt-ws"]),s["default"].prototype.$flespiCDN=a.currentRegion.cdn,s["default"].connector.setRegion(a.currentRegion),i("setToken",c),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](2),i("reqFailed",e.t0),"undefined"!==typeof a.isLoading&&s["default"].set(a,"isLoading",!1);case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))),Le.apply(this,arguments)}var qe={poolDevices:ke,checkConnection:De,getLastUpdatePosition:Qe,getInitDataByDeviceId:Oe,getRegions:Ne,initConnection:Te},Re=(n("4917"),n("f751"),n("8c4f")),je=[{path:"/",component:function(){return Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"f241"))},children:[{path:"devices/:devices",component:function(){return Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"f241"))}}]},{path:"/token/:token",component:function(){return n.e(2).then(n.bind(null,"013f"))}},{path:"/login",component:function(){return n.e(2).then(n.bind(null,"013f"))}},{path:"/login/:token",component:function(){return n.e(2).then(n.bind(null,"013f"))}},{path:"/login/:token/devices/:devices",component:function(){return Promise.all([n.e(0),n.e(1)]).then(n.bind(null,"f241"))}},{path:"*",component:function(){return n.e(5).then(n.bind(null,"e51e"))}}];s["default"].use(Re["a"]);var Ee=new Re["a"]({mode:"hash",base:"",scrollBehavior:function(){return{y:0}},routes:je}),Me=Ee,Pe=n("ef44");function _e(e){0}function Ae(e,t){var n=t.type,a=t.payload,r=a.result;switch(n){case"postMessage":X["a"].create({message:"Post message to devices with IDs ".concat(r," success"),type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:JSON.stringify(e[n])!==JSON.stringify(r)&&s["default"].set(e,n,r)}}function $e(e,t){if(JSON.stringify(e.devices)!==JSON.stringify(t.data.result)&&s["default"].set(e,"devices",t.data.result),!e.hasDevicesInit)if(e.activeDevicesID.length)e.activeDevicesID.forEach((function(n){t.data.result.filter((function(e){return e.id===n})).length||Ge(e,n)})),Ke(e);else{Ke(e);var n=Object(Pe["a"])({store:Z["a"],storeName:e.storeName,name:"active"});n&&n.length&&n.forEach((function(n){t.data.result.filter((function(e){return e.id===n})).length&&ze(e,n)}))}}function Fe(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some((function(n,a){return n.id===t.device.id&&(e.devices[a]=Object.assign(e.devices[a],t.device),!0)}));break;case"deleted":e.devices.some((function(n,a){return n.id===t.device.id&&(e.devices.splice(a,1),!0)}));break}}function Je(e,t){if(t.response&&t.response.status)switch(t.response.status){case 0:He(e,!0),Ue(e),s["default"].set(e,"token","");break;case 401:Be(e);break;default:t.response.data&&t.response.data.errors&&t.response.data.errors.length&&t.response.data.errors.forEach((function(t){We(e,t.reason)}))}else if(t.code&&t.message)switch(t.code){case 2:case 134:case 135:e.token&&Be(e),We(e,t.message);break}else We(e,t.message)}function He(e,t){s["default"].set(e,"offline",t)}function Ve(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(s["default"].connector.token="FlespiToken ".concat(n),Object(Pe["b"])({store:ee["a"],storeName:e.storeName,name:"token",value:n})):(n="",s["default"].connector.token="",Be(e)),s["default"].set(e,"token",n)}function Be(e){Object(Pe["b"])({store:ee["a"],storeName:e.storeName,name:"token",value:null}),s["default"].connector.token="",e.socketOffline&&Xe(e,!1),s["default"].set(e,"token","")}function ze(e,t){e.hasDevicesInit&&!e.devices.filter((function(e){return e.id===t}))[0].messages_ttl||(e.activeDevicesID.push(t),Object(Pe["b"])({store:Z["a"],storeName:e.storeName,name:"active",value:e.activeDevicesID}),e.hasDevicesInit&&Me.push("/devices/".concat(e.activeDevicesID.join(","))))}function Ge(e,t){var n=e.activeDevicesID.indexOf(t);e.activeDevicesID.splice(n,1),Object(Pe["b"])({store:Z["a"],storeName:e.storeName,name:"active",value:e.activeDevicesID}),e.activeDevicesID.length?Me.push("/devices/".concat(e.activeDevicesID.join(","))):Me.push("/")}function Ke(e){e.hasDevicesInit=!0}function Ue(e){e.hasDevicesInit=!1,s["default"].set(e,"devices",[]),s["default"].set(e,"activeDevicesID",[])}function We(e,t){if(!e.token)return!1;X["a"].create({color:"negative",icon:"warning",message:"".concat(t),timeout:1e3}),e.newNotificationCounter++,e.errors.push(t)}function Xe(e,t){s["default"].set(e,"socketOffline",t)}function Ye(e){s["default"].set(e,"errors",[])}function Ze(e,t){e.regions=t}function et(e,t){e.currentRegion=t,Object(Pe["b"])({store:ee["a"],storeName:e.storeName,name:"region",value:t.name})}function tt(e){e.currentRegion=null,Object(Pe["b"])({store:ee["a"],storeName:e.storeName,name:"region",value:null})}function nt(e){e.newNotificationCounter=0}function at(e,t){e.date=t}var rt={reqStart:_e,reqSuccessful:Ae,reqFailed:Je,setToken:Ve,clearToken:Be,setActiveDevice:ze,unsetActiveDevice:Ge,setDevicesInit:Ke,unsetDevicesInit:Ue,setOfflineFlag:He,updateDevices:Fe,setDevices:$e,setSocketOffline:Xe,clearNotificationCounter:nt,addError:We,clearErrors:Ye,setRegions:Ze,setCurrentRegion:et,clearCurrentRegion:tt,setDate:at},it={},ot={namespaced:!0},st={messages:ot};s["default"].use(he["a"]);var ct={token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1,socketOffline:!1,isLoading:!1,newNotificationCounter:0,errors:[],date:[0,0],regions:null,currentRegion:null,storeName:"flespi-trackit-settings"},ut=new he["a"].Store({state:ct,actions:qe,mutations:rt,getters:it,modules:st}),lt=ut,ft=function(){return dt.apply(this,arguments)};function dt(){return dt=o()(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("function"!==typeof lt){e.next=6;break}return e.next=3,lt({Vue:s["default"]});case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=lt;case 7:if(t=e.t0,"function"!==typeof Me){e.next=14;break}return e.next=11,Me({Vue:s["default"],store:t});case 11:e.t1=e.sent,e.next=15;break;case 14:e.t1=Me;case 15:return n=e.t1,t.$router=n,a={router:n,store:t,render:function(e){return e(ve)}},a.el="#q-app",e.abrupt("return",{app:a,store:t,router:n});case 20:case"end":return e.stop()}}),e)}))),dt.apply(this,arguments)}var pt=n("a925"),vt={failed:"Action failed",success:"Action was successful"},ht={"en-us":vt};s["default"].use(pt["a"]);var mt=new pt["a"]({locale:"en-us",fallbackLocale:"en-us",messages:ht}),gt=function(e){var t=e.app;t.i18n=mt},bt=(n("6b54"),n("553c")),wt=n.n(bt),kt=n("9224"),yt="",Dt="";-1===window.location.host.indexOf("flespi.io")?(yt="https://".concat(window.location.hostname,":9005"),Dt="wss://".concat(window.location.hostname,":9017")):-1!==window.location.pathname.indexOf("/trackit")&&(yt="https://".concat(window.location.host),Dt="wss://".concat(window.location.host));var xt=-1===window.location.host.indexOf("flespi.io"),Qt={protocolVersion:5,wsOptions:{objectMode:!1,perMessageDeflate:!0}},It={socketConfig:{server:Dt,clientId:"trackit-".concat(kt["version"]).concat(xt?"-dev":"","-").concat(Math.random().toString(16).substr(2,8)),mqttSettings:Qt},httpConfig:yt?{server:yt}:void 0},Ot=function(e){var t=e.Vue,n=e.store;t.prototype.$authHost=yt||"https://flespi.io",t.prototype.$flespiServer=yt||"https://flespi.io",t.use(wt.a,It),t.connector.socket.on("error",(function(e){n.commit("reqFailed",e)})),window&&window.addEventListener("beforeunload",(function(){t.connector.socket.close(!0)}))};function Ct(){return Nt.apply(this,arguments)}function Nt(){return Nt=o()(r.a.mark((function e(){var t,n,a,i,o,c,u,l,f;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ft();case 2:t=e.sent,n=t.app,a=t.store,i=t.router,o=!0,c=function(e){o=!1,window.location.href=e},u=window.location.href.replace(window.location.origin,""),l=[gt,Ot],f=0;case 11:if(!(!0===o&&f<l.length)){e.next=29;break}if("function"===typeof l[f]){e.next=14;break}return e.abrupt("continue",26);case 14:return e.prev=14,e.next=17,l[f]({app:n,router:i,store:a,Vue:s["default"],ssrContext:null,redirect:c,urlPath:u});case 17:e.next=26;break;case 19:if(e.prev=19,e.t0=e["catch"](14),!e.t0||!e.t0.url){e.next=24;break}return window.location.href=e.t0.url,e.abrupt("return");case 24:return console.error("[Quasar] boot error:",e.t0),e.abrupt("return");case 26:f++,e.next=11;break;case 29:if(!1!==o){e.next=31;break}return e.abrupt("return");case 31:new s["default"](n);case 32:case"end":return e.stop()}}),e,null,[[14,19]])}))),Nt.apply(this,arguments)}Ct()},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},"7e6d":function(e,t,n){},"85c2":function(e,t,n){"use strict";var a=n("1d10"),r=n.n(a);r.a},9224:function(e){e.exports=JSON.parse('{"name":"track-it","version":"1.3.0","description":"A simple application based on flespi.io and built with Quasar and Leaflet.js. Allows tracking different devices on the map, viewing telemetry messages for these devices.","productName":"TrackIt!","cordovaId":"org.cordova.quasar.app","capacitorId":"","author":"Sergey Buntsevich <scarry92@yandex.ru>","private":true,"scripts":{"lint":"eslint --ext .js,.vue src","dev":"quasar dev -m spa","dev_local":"env NODE_LOCAL=local quasar dev -m spa","build":"quasar build -m spa","deploy":"rm -rf dist && npm run build && rm -rf deploy && mkdir deploy && cp -R dist/spa/* misc LICENSE package.json deploy && cp README.md deploy/README.md && node_modules/git-directory-deploy/bin/git-directory-deploy.sh -ddeploy -bgh-pages -rhttps://git.gurtam.net/flespi/frontend/TrackIt.git && rm -rf deploy && git push github gh-pages"},"dependencies":{"@quasar/extras":"^1.5.2","flespi-io-js":"github:flespi-software/flespi-io-js#c6e8c7b4c3bbda061e5c08d7e6ced1af2889c16e","leaflet":"^1.6.0","leaflet.marker.slideto":"^0.2.0","leaflet.polyline.snakeanim":"^0.2.0","leaflet.polylinemeasure":"github:ppete2/Leaflet.PolylineMeasure#b85a4b9","lodash":"^4.17.19","moment":"^2.24.0","qtelemetry":"git+https://github.com/flespi-software/QTelemetry.git","quasar":"^1.9.4","qvirtualscroll":"github:flespi-software/QVirtualScroll#609997fd6aa168b08255c969890f95d36e604c35","vue-i18n":"^8.15.4","vue-virtual-scroll-list":"^1.4.6"},"devDependencies":{"@quasar/app":"^1.5.8","@vue/eslint-config-standard":"^5.1.2","babel-eslint":"^10.1.0","eslint":"^6.8.0","eslint-loader":"^3.0.3","eslint-plugin-import":"^2.20.1","eslint-plugin-node":"^11.0.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1","eslint-plugin-vue":"^6.2.1","git-directory-deploy":"^1.5.1"},"engines":{"node":">= 8.9.0","npm":">= 5.6.0","yarn":">= 1.6.0"},"browserslist":["last 1 version, not dead, ie >= 11"]}')},ef44:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));n("7f7f");function a(e){var t=e.store,n=e.storeName,a=e.name,r=t.getItem(n);return r&&r[a]}function r(e){var t=e.store,n=e.storeName,a=e.name,r=e.value,i=t.getItem(n);i||(i={}),r?i[a]=r:delete i[a],t.set(n,i)}}},[[0,4,0]]]);