webpackJsonp([3],{"+nwc":function(e,t){},0:function(e,t,n){e.exports=n("nplA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"3Puz":function(e,t){},4:function(e,t){},"4Th3":function(e,t){},JsEP:function(e,t){},MGDR:function(e,t,n){e.exports=n.p+"img/trackit.4dbf2ed.png"},N12Q:function(e,t){},R58i:function(e,t){},nplA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),a=n.n(i),o=(n("30VO"),n("/5sW")),s=n("7109");o.default.use(s.Q,{components:{QLayout:s.r,QLayoutDrawer:s.s,QPageContainer:s.y,QPage:s.x,QToolbar:s.K,QToolbarTitle:s.L,QBtn:s.g,QIcon:s.k,QList:s.t,QListHeader:s.u,QItem:s.m,QItemMain:s.n,QItemSide:s.o,QItemTile:s.p,QTooltip:s.M,QResizeObservable:s.B,QModal:s.v,QSelect:s.D,QInput:s.l,QKnob:s.q,QCheckbox:s.h,QModalLayout:s.w,QAlert:s.f,QTabs:s.I,QTab:s.G,QTabPane:s.H,QToggle:s.J,QPopover:s.z,QProgress:s.A,QSpinnerGears:s.F,QWindowResizeObservable:s.N,QDatetime:s.i,QSearch:s.C,QSlider:s.E,QField:s.j},plugins:{Notify:s.e,Loading:s.c,LocalStorage:s.d,Cookies:s.a,Dialog:s.b}});n("L4dm"),n("hAPP"),n("59Iv"),n("3Puz"),n("N12Q");var c={name:"offline",data:function(){return{intervalId:0}},created:function(){var e=this;this.intervalId=setInterval(function(){e.$store.dispatch("checkConnection")},5e3)}},r=n("XyMi");var u=function(e){n("4Th3")},l={name:"App",components:{Offline:Object(r.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.offline?n("div",{staticClass:"offline-page window-height window-width bg-light column items-center no-wrap"},[n("div",{staticClass:"offline-back"},[n("div",{staticClass:"offline-code"}),e._v(" "),n("div",{staticClass:"offline-line"},e._l(Array(20),function(t){return n("span",{key:t},[e._v("offline")])}))])]):e._e()},[],!1,u,null,null).exports}};var f=function(e){n("tHqv")},d=Object(r.a)(l,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"q-app"}},[t("router-view"),this._v(" "),t("offline",{attrs:{logo:"../statics/trackit.png"}})],1)},[],!1,f,null,null).exports,p=n("/ocq"),v=[{path:"/",component:function(){return n.e(1).then(n.bind(null,"yoYR"))}},{path:"/login",component:function(){return n.e(0).then(n.bind(null,"P7ry"))}},{path:"/login/:token",component:function(){return n.e(0).then(n.bind(null,"P7ry"))}},{path:"*",component:function(){return n.e(2).then(n.bind(null,"c5Mg"))}}];o.default.use(p.a);var h,m,g,k,w=new p.a({mode:"hash",base:"/",scrollBehavior:function(){return{y:0}},routes:v}),D=n("NYxO"),b=n("Gu7T"),Q=n.n(b),y=n("Xxa5"),x=n.n(y),I=n("exGp"),T=n.n(I),M={poolDevices:(h=T()(x.a.mark(function e(t){var n,i=this,a=t.state,s=t.commit;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s("reqStart"),e.prev=1,!a.token){e.next=7;break}return e.next=5,o.default.connector.poolDevices(function(e){s("setDevices",e)},function(e,t){s("updateDevices",{type:e,device:t})});case 5:return n=e.sent,e.abrupt("return",T()(x.a.mark(function e(){return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.default.connector.poolDevicesStop(n);case 2:case"end":return e.stop()}},e,i)})));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),s("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return h.apply(this,arguments)}),postMessage:(m=T()(x.a.mark(function e(t,n){t.state;var i,a,s=t.commit,c=n.data,r=n.id;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s("reqStart"),e.prev=1,e.next=4,o.default.connector.gw.postDevicesMessages(r,c);case 4:i=e.sent,a=i.data,s("reqSuccessful",{type:"postMessage",payload:a}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),s("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e,t){return m.apply(this,arguments)}),checkConnection:(g=T()(x.a.mark(function e(t){var n=t.state,i=t.commit;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.default.connector.http.external.get("./statics/icons/favicon-16x16.png?_="+(new Date).getTime());case 3:200===e.sent.status&&n.offline&&i("setOfflineFlag",!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),n.offline||i("setOfflineFlag",!0);case 11:case"end":return e.stop()}},e,this,[[0,7]])})),function(e){return g.apply(this,arguments)}),getLastUpdatePosition:(k=T()(x.a.mark(function e(t,n){var i,a,s,c=t.state;return x.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=n||c.activeDevicesID.join(","))){e.next=9;break}return e.next=4,o.default.connector.gw.getDevices(i,{fields:"id,telemetry"});case 4:return a=e.sent,s=Math.max.apply(Math,Q()(a.data.result.reduce(function(e,t){return e.push(t.telemetry&&t.telemetry["position.latitude"]?Math.floor(1e3*t.telemetry["position.latitude"].ts):0),e.push(t.telemetry&&t.telemetry["position.longitude"]?Math.floor(1e3*t.telemetry["position.longitude"].ts):0),e},[]))),e.abrupt("return",s-s%864e5);case 9:return e.abrupt("return",Date.now());case 10:case"end":return e.stop()}},e,this)})),function(e,t){return k.apply(this,arguments)})},P=n("woOf"),L=n.n(P),O=n("mvHQ"),S=n.n(O);function A(e,t){o.default.set(e,"offline",t)}function C(e){var t=s.a.get("X-Flespi-Token"),n=s.d.get.item("X-Flespi-Token");t&&n&&t===n&&s.a.remove("X-Flespi-Token"),s.d.remove("X-Flespi-Token"),o.default.connector.token="",o.default.set(e,"token","")}function F(e,t){e.devices.filter(function(e){return e.id===t})[0].messages_ttl&&(e.activeDevicesID.push(t),s.d.set("TrackIt Active Devices",e.activeDevicesID))}function q(e){e.hasDevicesInit=!0}function _(e){e.hasDevicesInit=!1,o.default.set(e,"devices",[]),o.default.set(e,"activeDevicesID",[])}var X={reqStart:function(e){},reqSuccessful:function(e,t){var n=t.type,i=t.payload.result;switch(n){case"postMessage":s.e.create({message:"Post message to devices with IDs "+i+" success",type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:S()(e[n])!==S()(i)&&o.default.set(e,n,i)}},reqFailed:function(e,t){switch(t.response.status){case 0:A(e,!0),_(e),o.default.set(e,"token","");break;case 401:C(e)}},setToken:function(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(o.default.connector.token="FlespiToken "+n,s.d.set("X-Flespi-Token",n)):(n="",o.default.connector.token="",C(e)),o.default.set(e,"token",n)},clearToken:C,setActiveDevice:F,unsetActiveDevice:function(e,t){var n=e.activeDevicesID.indexOf(t);e.activeDevicesID.splice(n,1),s.d.set("TrackIt Active Devices",e.activeDevicesID)},setDevicesInit:q,unsetDevicesInit:_,setOfflineFlag:A,updateDevices:function(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices[i]=L()(e.devices[i],t.device),!0)});break;case"deleted":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices.splice(i,1),!0)})}},setDevices:function(e,t){if(S()(e.devices)!==S()(t.data.result)&&o.default.set(e,"devices",t.data.result),!e.hasDevicesInit){q(e);var n=s.d.get.item("TrackIt Active Devices");n&&n.length&&n.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length&&F(e,n)})}}},E={messages:{namespaced:!0}};o.default.use(D.a);var z=new D.a.Store({state:{token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1,isLoading:!1},actions:M,mutations:X,getters:{},modules:E}),G=n("TXmL"),j={en:{failed:"Action failed",success:"Action was successful"}},H=n("LarL"),N=n.n(H),R={socketConfig:{clientId:"trackit-"+Math.random().toString(16).substr(2,8)}};-1===window.location.host.indexOf("localhost:9004")&&-1===window.location.host.indexOf("localhost:9005")&&-1===window.location.host.indexOf("localhost:7004")||(R={httpConfig:{server:"https://localhost",port:9005},socketConfig:{server:"wss://localhost:9017",clientId:"trackit-dev-"+Math.random().toString(16).substr(2,8)}});var V=n("wvfG"),$=n.n(V),B=n("v5o6"),J=n.n(B);o.default.config.productionTip=!1;var K=a()({el:"#q-app",router:w,store:z},d),W=[];W.push(function(e){var t=e.app;e.Vue.use(G.a),t.i18n=new G.a({locale:"en",fallbackLocale:"en",messages:j})}),W.push(function(e){var t=e.Vue;t.config.productionTip=!1,t.use(N.a,R)}),W.push(function(e){e.Vue.use($.a)}),W.forEach(function(e){return e({app:K,router:w,store:z,Vue:o.default})}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&document.addEventListener("DOMContentLoaded",function(){J.a.attach(document.body)},!1),new o.default(K)},tHqv:function(e,t){}},[0]);