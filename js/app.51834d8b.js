(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app"],{0:function(e,t,n){e.exports=n("2f39")},1:function(e,t){},"1d10":function(e,t,n){},2:function(e,t){},"2f39":function(e,t,n){"use strict";n.r(t);var a=n("967e"),r=n.n(a),i=(n("a481"),n("96cf"),n("5c7d"),n("1194"),n("7d6e"),n("e54f"),n("62f2"),n("7e6d"),n("2b0e")),s=n("b05d"),o=n("4d5a"),c=n("e359"),u=n("9404"),l=n("09e3"),f=n("9989"),d=n("65c6"),p=n("6ac5"),v=n("9c40"),g=n("0016"),h=n("1c1c"),m=n("66e5"),w=n("4074"),b=n("0170"),k=n("05c0"),y=n("3980"),D=n("24e8"),x=n("ddd8"),I=n("27f9"),Q=n("3845"),C=n("8f8e"),S=n("429b"),T=n("7460"),O=n("adad"),R=n("823b"),q=n("9564"),L=n("4e73"),E=n("58ea"),A=n("cf57"),M=n("c1d0"),j=n("8572"),N=n("7bbf"),P=n("b047"),$=n("b498"),F=n("f09f"),_=n("eb85"),J=n("4b7e"),V=n("a370"),B=n("714f"),H=n("7f67"),z=n("f449"),G=n("75c3"),K=n("2a19"),U=n("f5084"),W=n("18d6"),X=n("a639"),Y=n("436b");i["default"].use(s["a"],{config:{},components:{QLayout:o["a"],QHeader:c["a"],QDrawer:u["a"],QPageContainer:l["a"],QPage:f["a"],QToolbar:d["a"],QToolbarTitle:p["a"],QBtn:v["a"],QIcon:g["a"],QList:h["a"],QItem:m["a"],QItemSection:w["a"],QItemLabel:b["a"],QTooltip:k["a"],QResizeObserver:y["a"],QDialog:D["a"],QSelect:x["a"],QInput:I["a"],QKnob:Q["a"],QCheckbox:C["a"],QTabs:S["a"],QTab:T["a"],QTabPanels:O["a"],QTabPanel:R["a"],QToggle:q["a"],QMenu:L["a"],QCircularProgress:E["a"],QSpinnerGears:A["a"],QSlider:M["a"],QField:j["a"],QRange:N["a"],QChip:P["a"],QColor:$["a"],QCard:F["a"],QSeparator:_["a"],QCardActions:J["a"],QCardSection:V["a"]},directives:{Ripple:B["a"],ClosePopup:H["a"],TouchHold:z["a"],TouchPan:G["a"]},plugins:{Notify:K["a"],Loading:U["a"],LocalStorage:W["a"],SessionStorage:X["a"],Dialog:Y["a"]}});var Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"q-app"}},[n("router-view"),n("offline",{attrs:{logo:"../statics/trackit.png"}})],1)},ee=[],te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.offline||e.$store.state.socketOffline?n("div",{staticClass:"offline-page window-height window-width bg-light column items-center no-wrap"},[n("div",{staticClass:"offline-back"},[n("div",{staticClass:"offline-code"}),n("div",{staticClass:"offline-line"},e._l(Array(20),(function(t){return n("span",{key:t},[e._v("offline")])})),0)])]):e._e()},ne=[],ae={name:"offline",data:function(){return{intervalId:0}},created:function(){var e=this;this.intervalId=setInterval((function(){e.$store.dispatch("checkConnection")}),5e3)}},re=ae,ie=(n("85c2"),n("2877")),se=Object(ie["a"])(re,te,ne,!1,null,null,null),oe=se.exports,ce={name:"App",components:{Offline:oe}},ue=ce,le=Object(ie["a"])(ue,Z,ee,!1,null,null,null),fe=le.exports,de=n("2f62"),pe=(n("7f7f"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("4db1")),ve=n.n(pe),ge=n("9b02"),he=n.n(ge);function me(e){var t,n,a;return r.a.async((function(s){while(1)switch(s.prev=s.next){case 0:if(t=e.state,n=e.commit,n("reqStart"),s.prev=2,!t.token){s.next=8;break}return s.next=6,r.a.awrap(i["default"].connector.poolDevices((function(e){n("setDevices",e)}),(function(e,t){n("updateDevices",{type:e,device:t})})));case 6:return a=s.sent,s.abrupt("return",(function(){return r.a.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.a.awrap(i["default"].connector.poolDevicesStop(a));case 2:case"end":return e.stop()}}))}));case 8:s.next=13;break;case 10:s.prev=10,s.t0=s["catch"](2),n("reqFailed",s.t0);case 13:case"end":return s.stop()}}),null,null,[[2,10]])}function we(e){var t,n,a;return r.a.async((function(s){while(1)switch(s.prev=s.next){case 0:return t=e.state,n=e.commit,s.prev=1,s.next=4,r.a.awrap(i["default"].connector.http.external.get("./statics/icons/favicon-16x16.png?_=".concat((new Date).getTime())));case 4:a=s.sent,200===a.status&&t.offline&&n("setOfflineFlag",!1),s.next=12;break;case 8:s.prev=8,s.t0=s["catch"](1),t.offline||n("setOfflineFlag",!0);case 12:case"end":return s.stop()}}),null,null,[[1,8]])}function be(e,t){var n,a,s,o,c,u;return r.a.async((function(l){while(1)switch(l.prev=l.next){case 0:if(n=e.commit,a=e.state,s=t||a.activeDevicesID.join(","),!s){l.next=12;break}return l.next=5,r.a.awrap(i["default"].connector.gw.getDevicesTelemetry(s));case 5:return o=l.sent,c=o.data,c.errors&&postMessage.errors.forEach((function(e){n("addError",e.reason)})),u=Math.max.apply(Math,ve()(c.result.reduce((function(e,t){return e.push(t.telemetry&&t.telemetry["position.latitude"]?Math.floor(1e3*t.telemetry["position.latitude"].ts):0),e.push(t.telemetry&&t.telemetry["position.longitude"]?Math.floor(1e3*t.telemetry["position.longitude"].ts):0),e}),[]))),l.abrupt("return",u-u%864e5);case 12:return l.abrupt("return",Date.now());case 13:case"end":return l.stop()}}))}function ke(e,t){var n,a,s,o,c,u;return r.a.async((function(l){while(1)switch(l.prev=l.next){case 0:return n=e.commit,e.state,l.next=3,r.a.awrap(i["default"].connector.gw.getDevicesTelemetry(t));case 3:if(a=l.sent,s=a.data,s.errors&&postMessage.errors.forEach((function(e){n("addError",e.reason)})),o=s&&s.result[0]&&s.result[0].telemetry?s.result[0].telemetry:{},c=Object.keys(o),c.length){l.next=9;break}return l.abrupt("return",!1);case 9:u=c.reduce((function(e,t){return"position"===t?e:(e[t]=o[t].value,e)}),{}),u["x-flespi-inited-by-telemetry"]=!0,n("messages/".concat(t,"/setMessages"),[u]);case 12:case"end":return l.stop()}}))}function ye(e){var t,n,a,s,o;return r.a.async((function(c){while(1)switch(c.prev=c.next){case 0:return t=e.state,n=e.commit,c.prev=1,"undefined"!==typeof t.isLoading&&i["default"].set(t,"isLoading",!0),c.next=5,r.a.awrap(i["default"].connector.http.get("/auth/regions"));case 5:a=c.sent,s=he()(a,"data.result",[]),o=null,s=s.reduce((function(e,t){return t.default&&(o=t),e[t.name]=t,e}),{}),o&&n("setCurrentRegion",o),n("setRegions",s),c.next=17;break;case 13:c.prev=13,c.t0=c["catch"](1),n("reqFailed",c.t0),"undefined"!==typeof t.isLoading&&i["default"].set(t,"isLoading",!1);case 17:case"end":return c.stop()}}),null,null,[[1,13]])}function De(e,t){var n,a,s,o;return r.a.async((function(c){while(1)switch(c.prev=c.next){case 0:if(n=e.state,a=e.commit,s=t.region,o=t.token,c.prev=2,"undefined"!==typeof n.isLoading&&i["default"].set(n,"isLoading",!0),n.regions){c.next=7;break}return c.next=7,r.a.awrap(ye({state:n,commit:a}));case 7:s&&a("setCurrentRegion",n.regions[s]),i["default"].prototype.$flespiServer=n.currentRegion.rest,i["default"].prototype.$flespiSocketServer="wss://".concat(n.currentRegion["mqtt-ws"]),i["default"].prototype.$flespiCDN=n.currentRegion.cdn,i["default"].connector.setRegion(n.currentRegion),a("setToken",o),c.next=19;break;case 15:c.prev=15,c.t0=c["catch"](2),a("reqFailed",c.t0),"undefined"!==typeof n.isLoading&&i["default"].set(n,"isLoading",!1);case 19:case"end":return c.stop()}}),null,null,[[2,15]])}var xe={poolDevices:me,checkConnection:we,getLastUpdatePosition:be,getInitDataByDeviceId:ke,getRegions:ye,initConnection:De},Ie=(n("4917"),n("f751"),n("8c4f")),Qe=[{path:"/",component:function(){return Promise.all([n.e("vendor"),n.e("6719d95e")]).then(n.bind(null,"f241"))},children:[{path:"devices/:devices",component:function(){return Promise.all([n.e("vendor"),n.e("6719d95e")]).then(n.bind(null,"f241"))}}]},{path:"/token/:token",component:function(){return n.e("0a36d2d0").then(n.bind(null,"013f"))}},{path:"/login",component:function(){return n.e("0a36d2d0").then(n.bind(null,"013f"))}},{path:"/login/:token",component:function(){return n.e("0a36d2d0").then(n.bind(null,"013f"))}},{path:"/login/:token/devices/:devices",component:function(){return Promise.all([n.e("vendor"),n.e("6719d95e")]).then(n.bind(null,"f241"))}},{path:"*",component:function(){return n.e("4b47640d").then(n.bind(null,"e51e"))}}];i["default"].use(Ie["a"]);var Ce=new Ie["a"]({mode:"hash",base:"",scrollBehavior:function(){return{y:0}},routes:Qe}),Se=Ce;function Te(e){0}function Oe(e,t){var n=t.type,a=t.payload,r=a.result;switch(n){case"postMessage":K["a"].create({message:"Post message to devices with IDs ".concat(r," success"),type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:JSON.stringify(e[n])!==JSON.stringify(r)&&i["default"].set(e,n,r)}}function Re(e,t){if(JSON.stringify(e.devices)!==JSON.stringify(t.data.result)&&i["default"].set(e,"devices",t.data.result),!e.hasDevicesInit)if(e.activeDevicesID.length)e.activeDevicesID.forEach((function(n){t.data.result.filter((function(e){return e.id===n})).length||Ne(e,n)})),Pe(e);else{Pe(e);var n=W["a"].getItem("TrackIt Active Devices");n&&n.length&&n.forEach((function(n){t.data.result.filter((function(e){return e.id===n})).length&&je(e,n)}))}}function qe(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some((function(n,a){return n.id===t.device.id&&(e.devices[a]=Object.assign(e.devices[a],t.device),!0)}));break;case"deleted":e.devices.some((function(n,a){return n.id===t.device.id&&(e.devices.splice(a,1),!0)}));break}}function Le(e,t){if(t.response&&t.response.status)switch(t.response.status){case 0:Ee(e,!0),$e(e),i["default"].set(e,"token","");break;case 401:Me(e);break;default:t.response.data&&t.response.data.errors&&t.response.data.errors.length&&t.response.data.errors.forEach((function(t){Fe(e,t.reason)}))}else if(t.code&&t.message)switch(t.code){case 2:case 134:case 135:e.token&&Me(e),Fe(e,t.message);break}else Fe(e,t.message)}function Ee(e,t){i["default"].set(e,"offline",t)}function Ae(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(i["default"].connector.token="FlespiToken ".concat(n),X["a"].set("flespi-trackit-token",n)):(n="",i["default"].connector.token="",Me(e)),i["default"].set(e,"token",n)}function Me(e){X["a"].remove("flespi-trackit-token"),i["default"].connector.token="",e.socketOffline&&_e(e,!1),i["default"].set(e,"token","")}function je(e,t){e.hasDevicesInit&&!e.devices.filter((function(e){return e.id===t}))[0].messages_ttl||(e.activeDevicesID.push(t),W["a"].set("TrackIt Active Devices",e.activeDevicesID),e.hasDevicesInit&&Se.push("/devices/".concat(e.activeDevicesID.join(","))))}function Ne(e,t){var n=e.activeDevicesID.indexOf(t);e.activeDevicesID.splice(n,1),W["a"].set("TrackIt Active Devices",e.activeDevicesID),e.activeDevicesID.length?Se.push("/devices/".concat(e.activeDevicesID.join(","))):Se.push("/")}function Pe(e){e.hasDevicesInit=!0}function $e(e){e.hasDevicesInit=!1,i["default"].set(e,"devices",[]),i["default"].set(e,"activeDevicesID",[])}function Fe(e,t){if(!e.token)return!1;K["a"].create({color:"negative",icon:"warning",message:"".concat(t),timeout:1e3}),e.newNotificationCounter++,e.errors.push(t)}function _e(e,t){i["default"].set(e,"socketOffline",t)}function Je(e){i["default"].set(e,"errors",[])}function Ve(e,t){e.regions=t}function Be(e,t){e.currentRegion=t,X["a"].set("flespi-trackit-region",t.name)}function He(e){e.currentRegion=null,X["a"].remove("flespi-trackit-region")}function ze(e){e.newNotificationCounter=0}var Ge={reqStart:Te,reqSuccessful:Oe,reqFailed:Le,setToken:Ae,clearToken:Me,setActiveDevice:je,unsetActiveDevice:Ne,setDevicesInit:Pe,unsetDevicesInit:$e,setOfflineFlag:Ee,updateDevices:qe,setDevices:Re,setSocketOffline:_e,clearNotificationCounter:ze,addError:Fe,clearErrors:Je,setRegions:Ve,setCurrentRegion:Be,clearCurrentRegion:He},Ke={},Ue={namespaced:!0},We={messages:Ue};i["default"].use(de["a"]);var Xe={token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1,socketOffline:!1,isLoading:!1,newNotificationCounter:0,errors:[],regions:null,currentRegion:null},Ye=new de["a"].Store({state:Xe,actions:xe,mutations:Ge,getters:Ke,modules:We}),Ze=Ye;function et(){var e,t,n;return r.a.async((function(a){while(1)switch(a.prev=a.next){case 0:if("function"!==typeof Ze){a.next=6;break}return a.next=3,r.a.awrap(Ze({Vue:i["default"]}));case 3:a.t0=a.sent,a.next=7;break;case 6:a.t0=Ze;case 7:if(e=a.t0,"function"!==typeof Se){a.next=14;break}return a.next=11,r.a.awrap(Se({Vue:i["default"],store:e}));case 11:a.t1=a.sent,a.next=15;break;case 14:a.t1=Se;case 15:return t=a.t1,e.$router=t,n={el:"#q-app",router:t,store:e,render:function(e){return e(fe)}},a.abrupt("return",{app:n,store:e,router:t});case 19:case"end":return a.stop()}}))}var tt=n("a925"),nt={failed:"Action failed",success:"Action was successful"},at={"en-us":nt};i["default"].use(tt["a"]);var rt=new tt["a"]({locale:"en-us",fallbackLocale:"en-us",messages:at}),it=function(e){var t=e.app;t.i18n=rt},st=(n("6b54"),n("553c")),ot=n.n(st),ct=n("9224"),ut="",lt="";-1===window.location.host.indexOf("flespi.io")?(ut="https://".concat(window.location.hostname,":9005"),lt="wss://".concat(window.location.hostname,":9017")):-1!==window.location.pathname.indexOf("/trackit")&&(ut="https://".concat(window.location.host),lt="wss://".concat(window.location.host));var ft=-1===window.location.host.indexOf("flespi.io"),dt={protocolVersion:5,wsOptions:{objectMode:!1,perMessageDeflate:!0}},pt={socketConfig:{server:lt,clientId:"trackit-".concat(ct["version"]).concat(ft?"-dev":"","-").concat(Math.random().toString(16).substr(2,8)),mqttSettings:dt},httpConfig:ut?{server:ut}:void 0},vt=function(e){var t=e.Vue,n=e.store;t.prototype.$authHost=ut||"https://flespi.io",t.prototype.$flespiServer=ut||"https://flespi.io",t.use(ot.a,pt),t.connector.socket.on("error",(function(e){n.commit("reqFailed",e)})),window&&window.addEventListener("beforeunload",(function(){t.connector.socket.close(!0)}))};function gt(){var e,t,n,a,s,o,c,u,l;return r.a.async((function(f){while(1)switch(f.prev=f.next){case 0:return f.next=2,r.a.awrap(et());case 2:e=f.sent,t=e.app,n=e.store,a=e.router,s=!0,o=function(e){s=!1,window.location.href=e},c=window.location.href.replace(window.location.origin,""),u=[it,vt],l=0;case 11:if(!(!0===s&&l<u.length)){f.next=29;break}if("function"===typeof u[l]){f.next=14;break}return f.abrupt("continue",26);case 14:return f.prev=14,f.next=17,r.a.awrap(u[l]({app:t,router:a,store:n,Vue:i["default"],ssrContext:null,redirect:o,urlPath:c}));case 17:f.next=26;break;case 19:if(f.prev=19,f.t0=f["catch"](14),!f.t0||!f.t0.url){f.next=24;break}return window.location.href=f.t0.url,f.abrupt("return");case 24:return console.error("[Quasar] boot error:",f.t0),f.abrupt("return");case 26:l++,f.next=11;break;case 29:if(!1!==s){f.next=31;break}return f.abrupt("return");case 31:new i["default"](t);case 32:case"end":return f.stop()}}),null,null,[[14,19]])}gt()},3:function(e,t){},4:function(e,t){},"7e6d":function(e,t,n){},"85c2":function(e,t,n){"use strict";var a=n("1d10"),r=n.n(a);r.a},9224:function(e){e.exports=JSON.parse('{"name":"track-it","version":"0.8.4","description":"A simple application based on flespi.io and built with Quasar and Leaflet.js. Allows tracking different devices on the map, viewing telemetry messages for these devices.","productName":"TrackIt!","cordovaId":"org.cordova.quasar.app","capacitorId":"","author":"Sergey Buntsevich <scarry92@yandex.ru>","private":true,"scripts":{"lint":"eslint --ext .js,.vue src","dev":"quasar dev -m spa","build":"quasar build -m spa","deploy":"rm -rf dist && npm run build && rm -rf deploy && mkdir deploy && cp -R dist/spa/* misc LICENSE package.json deploy && cp README.md deploy/README.md && node_modules/git-directory-deploy/bin/git-directory-deploy.sh -ddeploy -bgh-pages -rhttps://git.gurtam.net/flespi/frontend/TrackIt.git && rm -rf deploy && git push github gh-pages"},"dependencies":{"@quasar/extras":"^1.0.0","flespi-io-js":"git+https://github.com/flespi-software/flespi-io-js.git","leaflet":"^1.6.0","leaflet.marker.slideto":"^0.2.0","leaflet.polyline.snakeanim":"^0.2.0","lodash":"^4.17.15","moment":"^2.24.0","qtelemetry":"git+https://github.com/flespi-software/QTelemetry.git","quasar":"^1.5.9","qvirtualscroll":"git+https://github.com/flespi-software/QVirtualScroll.git","vue-i18n":"^8.15.1","vue-virtual-scroll-list":"^1.4.4"},"devDependencies":{"@quasar/app":"^1.4.1","@vue/eslint-config-standard":"^4.0.0","babel-eslint":"^10.0.1","eslint":"^5.10.0","eslint-loader":"^2.1.1","eslint-plugin-vue":"^5.0.0","git-directory-deploy":"^1.5.1"},"engines":{"node":">= 8.9.0","npm":">= 5.6.0","yarn":">= 1.6.0"},"browserslist":["last 1 version, not dead, ie >= 11"]}')}},[[0,"runtime","vendor"]]]);