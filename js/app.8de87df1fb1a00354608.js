webpackJsonp([3],{"+nwc":function(e,t){},0:function(e,t,n){e.exports=n("nplA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"3Puz":function(e,t){},4:function(e,t){},JsEP:function(e,t){},N12Q:function(e,t){},R58i:function(e,t){},nplA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),s=n.n(i),a=(n("30VO"),n("/5sW")),c=n("7109");a.a.use(c.J,{components:{QLayout:c.p,QLayoutDrawer:c.q,QPageContainer:c.w,QPage:c.v,QToolbar:c.G,QToolbarTitle:c.H,QBtn:c.g,QIcon:c.i,QList:c.r,QListHeader:c.s,QItem:c.k,QItemMain:c.l,QItemSide:c.m,QItemTile:c.n,QTooltip:c.I,QResizeObservable:c.z,QModal:c.t,QSelect:c.A,QInput:c.j,QKnob:c.o,QCheckbox:c.h,QModalLayout:c.u,QAlert:c.f,QTabs:c.E,QTab:c.C,QTabPane:c.D,QToggle:c.F,QPopover:c.x,QProgress:c.y,QSpinnerGears:c.B},plugins:{Notify:c.e,Loading:c.c,LocalStorage:c.d,Cookies:c.a,Dialog:c.b}});n("L4dm"),n("hAPP"),n("59Iv"),n("3Puz"),n("N12Q");var o=n("XyMi");var r=function(e){n("tHqv")},u=Object(o.a)({name:"App"},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"q-app"}},[t("router-view")],1)},[],!1,r,null,null).exports,v=n("/ocq"),f=[{path:"/",component:function(){return n.e(1).then(n.bind(null,"yoYR"))}},{path:"/login",component:function(){return n.e(0).then(n.bind(null,"P7ry"))}},{path:"/login/:token",component:function(){return n.e(0).then(n.bind(null,"P7ry"))}},{path:"*",component:function(){return n.e(2).then(n.bind(null,"c5Mg"))}}];a.a.use(v.a);var l,p,d=new v.a({mode:"hash",base:"/",scrollBehavior:function(){return{y:0}},routes:f}),h=n("NYxO"),m=n("Xxa5"),D=n.n(m),g=n("exGp"),k=n.n(g);var w={poolDevices:(l=k()(D.a.mark(function e(t){var n,i=this,s=t.state,c=t.commit;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c("reqStart"),e.prev=1,!s.token){e.next=7;break}return e.next=5,a.a.connector.poolDevices(function(e){c("setDevices",e)},function(e,t){c("updateDevices",{type:e,device:t})});case 5:return n=e.sent,e.abrupt("return",k()(D.a.mark(function e(){return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.connector.poolDevicesStop(n);case 2:case"end":return e.stop()}},e,i)})));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),c("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return l.apply(this,arguments)}),postMessage:(p=k()(D.a.mark(function e(t,n){t.state;var i,s,c=t.commit,o=n.data,r=n.id;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c("reqStart"),e.prev=1,e.next=4,a.a.connector.gw.postDevicesMessages(r,o);case 4:i=e.sent,s=i.data,c("reqSuccessful",{type:"postMessage",payload:s}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),c("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e,t){return p.apply(this,arguments)}),checkConnection:function(e){e.state;var t=e.commit;a.a.connector.http.get("/statics/icons/favicon-16x16.png?_="+(new Date).getTime()).then(function(e){200===e.status&&t("setOfflineFlag",!1)}).catch(function(e){console.log(e)})}},b=n("woOf"),I=n.n(b),Q=n("mvHQ"),y=n.n(Q);function x(e,t){a.a.set(e,"offline",t)}function T(e){var t=c.a.get("X-Flespi-Token"),n=c.d.get.item("X-Flespi-Token");t&&n&&t===n&&c.a.remove("X-Flespi-Token"),c.d.remove("X-Flespi-Token"),a.a.connector.token="",a.a.set(e,"token","")}function S(e,t){e.devices.filter(function(e){return e.id===t})[0].messages_ttl&&(e.activeDevicesID.push(t),c.d.set("TrackIt Active Devices",e.activeDevicesID))}function q(e){e.hasDevicesInit=!0}function M(e){e.hasDevicesInit=!1,a.a.set(e,"devices",[]),a.a.set(e,"activeDevicesID",[])}var P={reqStart:function(e){},reqSuccessful:function(e,t){var n=t.type,i=t.payload.result;switch(n){case"postMessage":c.e.create({message:"Post message to devices with IDs "+i+" success",type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:y()(e[n])!==y()(i)&&a.a.set(e,n,i)}},reqFailed:function(e,t){switch(t.response.status){case 0:x(e,!0),M(e),a.a.set(e,"token","");break;case 401:T(e)}},setToken:function(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(a.a.connector.token="FlespiToken "+n,c.d.set("X-Flespi-Token",n)):(n="",a.a.connector.token="",T(e)),a.a.set(e,"token",n)},clearToken:T,setActiveDevice:S,unsetActiveDevice:function(e,t){e.activeDevicesID=e.activeDevicesID.filter(function(e){return e!==t}),c.d.set("TrackIt Active Devices",e.activeDevicesID)},setDevicesInit:q,unsetDevicesInit:M,setOfflineFlag:x,updateDevices:function(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices[i]=I()(e.devices[i],t.device),!0)});break;case"deleted":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices.splice(i,1),!0)})}},setDevices:function(e,t){if(y()(e.devices)!==y()(t.data.result)&&a.a.set(e,"devices",t.data.result),!e.hasDevicesInit){q(e);var n=c.d.get.item("TrackIt Active Devices");n&&n.length&&n.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length&&S(e,n)})}}};var A={getHistoryByDeviceID:function(e,t){var n=this,i=e.state,s=e.commit,c=e.rootState;s("reqStart");var o,r={count:10,reverse:!0,filter:"position.latitude,position.longitude",to:i.timestamp||0};t.forEach(function(e){i.entities[e]||a.a.set(i.entities,e,[])});try{c.token&&t.forEach((o=k()(D.a.mark(function e(t){var i,c;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.connector.gw.getDevicesMessages(t,{data:y()(r)});case 2:i=e.sent,c=i.data,s("reqSuccessful",c);case 5:case"end":return e.stop()}},e,n)})),function(e){return o.apply(this,arguments)}))}catch(e){s("reqFailed",e,{root:!0})}}},F=n("Gu7T"),L=n.n(F);function O(e,t){var n=t.result;e.activeDevicesID.forEach(function(t){var i=n.filter(function(e){return e.device_id===t});if(!i.length)return e.entities[t]||a.a.set(e.entities,t,[]),!1;var s=e.entities[t]||[];a.a.set(e.entities,t,[].concat(L()(i),L()(s)).slice(0,10))}),a.a.set(e,"timestamp",parseInt(e.activeDevicesID.reduce(function(t,n){return e.entities[n].length&&e.entities[n][0].timestamp>t?e.entities[n][0].timestamp:t},0)))}var E={messages:{namespaced:!0,state:{entities:{},timestamp:0,activeDevicesID:[]},actions:A,mutations:{reqStart:function(e){},reqSuccessful:O,clear:function(e){var t,n=this;e.activeDevicesID.length&&(e.activeDevicesID.forEach((t=k()(D.a.mark(function e(t){return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.a.connector.unsubscribeMessagesDevices(t);case 2:case"end":return e.stop()}},e,n)})),function(e){return t.apply(this,arguments)})),a.a.set(e,"entities",{}),a.a.set(e,"activeDevicesID",[]),a.a.set(e,"timestamp",0))},clearByID:function(e,t){a.a.connector.unsubscribeMessagesDevices(t),a.a.delete(e.entities,t)},setActiveDevicesID:function(e,t){var n,i=this;t.filter(function(t){return!e.activeDevicesID.includes(t)}).forEach((n=k()(D.a.mark(function t(n){return D.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.a.connector.subscribeMessagesDevices(n,function(t){O(e,{result:[JSON.parse(t)]})});case 2:case"end":return t.stop()}},t,i)})),function(e){return n.apply(this,arguments)})),a.a.set(e,"activeDevicesID",t)}}}};a.a.use(h.b);var C=new h.b.Store({state:{token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1},actions:w,mutations:P,getters:{},modules:E}),X=n("TXmL"),_={en:{failed:"Action failed",success:"Action was successful"}},H=n("LarL"),z=n.n(H),B={socketConfig:{clientId:"trackit-"+Math.random().toString(16).substr(2,8)}};-1===window.location.host.indexOf("localhost:9004")&&-1===window.location.host.indexOf("localhost:9005")&&-1===window.location.host.indexOf("localhost:7004")||(B={httpConfig:{server:"https://localhost",port:9005},socketConfig:{server:"wss://localhost:9017",clientId:"trackit-dev-"+Math.random().toString(16).substr(2,8)}});var N=n("v5o6"),G=n.n(N);a.a.config.productionTip=!1;var J=s()({el:"#q-app",router:d,store:C},u),V=[];V.push(function(e){var t=e.app;e.Vue.use(X.a),t.i18n=new X.a({locale:"en",fallbackLocale:"en",messages:_})}),V.push(function(e){var t=e.Vue;t.config.productionTip=!1,t.use(z.a,B)}),V.forEach(function(e){return e({app:J,router:d,store:C,Vue:a.a})}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&document.addEventListener("DOMContentLoaded",function(){G.a.attach(document.body)},!1),new a.a(J)},tHqv:function(e,t){}},[0]);