webpackJsonp([3],{"+nwc":function(e,t){},0:function(e,t,n){e.exports=n("nplA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"3Puz":function(e,t){},4:function(e,t){},"4Th3":function(e,t){},JsEP:function(e,t){},MGDR:function(e,t,n){e.exports=n.p+"img/trackit.4dbf2ed.png"},N12Q:function(e,t){},R58i:function(e,t){},nplA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),o=n.n(i),a=(n("30VO"),n("/5sW")),s=n("7109");a.default.use(s.W,{components:{QLayout:s.t,QLayoutDrawer:s.u,QPageContainer:s.A,QPage:s.z,QToolbar:s.N,QToolbarTitle:s.O,QBtn:s.g,QIcon:s.m,QList:s.v,QListHeader:s.w,QItem:s.o,QItemMain:s.p,QItemSide:s.q,QItemTile:s.r,QTooltip:s.P,QResizeObservable:s.E,QModal:s.x,QSelect:s.G,QInput:s.n,QKnob:s.s,QCheckbox:s.h,QModalLayout:s.y,QAlert:s.f,QTabs:s.L,QTab:s.J,QTabPane:s.K,QToggle:s.M,QPopover:s.B,QProgress:s.C,QSpinnerGears:s.I,QWindowResizeObservable:s.Q,QDatetime:s.k,QSearch:s.F,QSlider:s.H,QField:s.l,QRange:s.D,QChip:s.i,QColorPicker:s.j},directives:{TouchPan:s.S,TouchHold:s.R},plugins:{Notify:s.e,Loading:s.c,LocalStorage:s.d,Cookies:s.a,Dialog:s.b}});n("L4dm"),n("hAPP"),n("59Iv"),n("3Puz"),n("N12Q");var r={name:"offline",data:function(){return{intervalId:0}},created:function(){var e=this;this.intervalId=setInterval(function(){e.$store.dispatch("checkConnection")},5e3)}},c=n("XyMi");var u=function(e){n("4Th3")},l={name:"App",components:{Offline:Object(c.a)(r,function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.offline||e.$store.state.socketOffline?n("div",{staticClass:"offline-page window-height window-width bg-light column items-center no-wrap"},[n("div",{staticClass:"offline-back"},[n("div",{staticClass:"offline-code"}),e._v(" "),n("div",{staticClass:"offline-line"},e._l(Array(20),function(t){return n("span",{key:t},[e._v("offline")])}))])]):e._e()},[],!1,u,null,null).exports}};var f=function(e){n("tHqv")},d=Object(c.a)(l,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"q-app"}},[t("router-view"),this._v(" "),t("offline",{attrs:{logo:"../statics/trackit.png"}})],1)},[],!1,f,null,null).exports,v=n("/ocq"),p=[{path:"/",component:function(){return n.e(0).then(n.bind(null,"yoYR"))},children:[{path:"devices/:devices",component:function(){return n.e(0).then(n.bind(null,"yoYR"))}}]},{path:"/login",component:function(){return n.e(1).then(n.bind(null,"P7ry"))}},{path:"/login/:token",component:function(){return n.e(1).then(n.bind(null,"P7ry"))}},{path:"/login/:token/devices/:devices",component:function(){return n.e(0).then(n.bind(null,"yoYR"))}},{path:"*",component:function(){return n.e(2).then(n.bind(null,"c5Mg"))}}];a.default.use(v.a);var h,m,g,D,k=new v.a({mode:"hash",base:"/",scrollBehavior:function(){return{y:0}},routes:p}),w=n("NYxO"),b=n("Gu7T"),Q=n.n(b),I=n("Xxa5"),y=n.n(I),x=n("exGp"),T=n.n(x),O=(h=T()(y.a.mark(function e(t){var n,i=this,o=t.state,s=t.commit;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s("reqStart"),e.prev=1,!o.token){e.next=7;break}return e.next=5,a.default.connector.poolDevices(function(e){s("setDevices",e)},function(e,t){s("updateDevices",{type:e,device:t})});case 5:return n=e.sent,e.abrupt("return",T()(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.connector.poolDevicesStop(n);case 2:case"end":return e.stop()}},e,i)})));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),s("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return h.apply(this,arguments)}),C=(m=T()(y.a.mark(function e(t,n){t.state;var i,o,s=t.commit,r=n.data,c=n.id;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s("reqStart"),e.prev=1,e.next=4,a.default.connector.gw.postDevicesMessages(c,r);case 4:i=e.sent,(o=i.data).errors&&o.errors.forEach(function(e){s("addError",e.reason)}),s("reqSuccessful",{type:"postMessage",payload:o}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),s("reqFailed",e.t0);case 13:case"end":return e.stop()}},e,this,[[1,10]])})),function(e,t){return m.apply(this,arguments)}),P=(g=T()(y.a.mark(function e(t){var n=t.state,i=t.commit;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.default.connector.http.external.get("./statics/icons/favicon-16x16.png?_="+(new Date).getTime());case 3:200===e.sent.status&&n.offline&&i("setOfflineFlag",!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),n.offline||i("setOfflineFlag",!0);case 11:case"end":return e.stop()}},e,this,[[0,7]])})),function(e){return g.apply(this,arguments)}),M=(D=T()(y.a.mark(function e(t,n){var i,o,s,r,c=t.commit,u=t.state;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=n||u.activeDevicesID.join(","))){e.next=11;break}return e.next=4,a.default.connector.gw.getDevices(i,{fields:"id,telemetry"});case 4:return o=e.sent,(s=o.data).errors&&C.errors.forEach(function(e){c("addError",e.reason)}),r=Math.max.apply(Math,Q()(s.result.reduce(function(e,t){return e.push(t.telemetry&&t.telemetry["position.latitude"]?Math.floor(1e3*t.telemetry["position.latitude"].ts):0),e.push(t.telemetry&&t.telemetry["position.longitude"]?Math.floor(1e3*t.telemetry["position.longitude"].ts):0),e},[]))),e.abrupt("return",r-r%864e5);case 11:return e.abrupt("return",Date.now());case 12:case"end":return e.stop()}},e,this)})),function(e,t){return D.apply(this,arguments)}),S={poolDevices:O,postMessage:C,checkConnection:P,getLastUpdatePosition:M},L=n("woOf"),A=n.n(L),F=n("mvHQ"),q=n.n(F);function E(e,t){a.default.set(e,"offline",t)}function _(e){var t=s.a.get("X-Flespi-Token"),n=s.d.get.item("X-Flespi-Token");t&&n&&t===n&&s.a.remove("X-Flespi-Token"),s.d.remove("X-Flespi-Token"),a.default.connector.token="",a.default.set(e,"token","")}function N(e,t){e.hasDevicesInit&&!e.devices.filter(function(e){return e.id===t})[0].messages_ttl||(e.activeDevicesID.push(t),s.d.set("TrackIt Active Devices",e.activeDevicesID),e.hasDevicesInit&&k.push("/devices/"+e.activeDevicesID.join(",")))}function R(e,t){var n=e.activeDevicesID.indexOf(t);e.activeDevicesID.splice(n,1),s.d.set("TrackIt Active Devices",e.activeDevicesID),e.activeDevicesID.length?k.push("/devices/"+e.activeDevicesID.join(",")):k.push("/")}function X(e){e.hasDevicesInit=!0}function j(e){e.hasDevicesInit=!1,a.default.set(e,"devices",[]),a.default.set(e,"activeDevicesID",[])}function z(e,t){s.e.create({type:"negative",icon:"warning",message:""+t,timeout:1e3}),e.newNotificationCounter++,e.errors.push(t)}var G={reqStart:function(e){},reqSuccessful:function(e,t){var n=t.type,i=t.payload.result;switch(n){case"postMessage":s.e.create({message:"Post message to devices with IDs "+i+" success",type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:q()(e[n])!==q()(i)&&a.default.set(e,n,i)}},reqFailed:function(e,t){if(t.response&&t.response.status)switch(t.response.status){case 0:E(e,!0),j(e),a.default.set(e,"token","");break;case 401:_(e);break;default:t.response.data&&t.response.data.errors&&t.response.data.errors.length&&t.response.data.errors.forEach(function(t){z(e,t.reason)})}else z(e,t.message)},setToken:function(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(a.default.connector.token="FlespiToken "+n,s.d.set("X-Flespi-Token",n)):(n="",a.default.connector.token="",_(e)),a.default.set(e,"token",n)},clearToken:_,setActiveDevice:N,unsetActiveDevice:R,setDevicesInit:X,unsetDevicesInit:j,setOfflineFlag:E,updateDevices:function(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices[i]=A()(e.devices[i],t.device),!0)});break;case"deleted":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices.splice(i,1),!0)})}},setDevices:function(e,t){if(q()(e.devices)!==q()(t.data.result)&&a.default.set(e,"devices",t.data.result),!e.hasDevicesInit)if(e.activeDevicesID.length)e.activeDevicesID.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length||R(e,n)}),X(e);else{X(e);var n=s.d.get.item("TrackIt Active Devices");n&&n.length&&n.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length&&N(e,n)})}},setSocketOffline:function(e,t){a.default.set(e,"socketOffline",t)},clearNotificationCounter:function(e){e.newNotificationCounter=0},addError:z},H={messages:{namespaced:!0}};a.default.use(w.a);var $=new w.a.Store({state:{token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1,socketOffline:!1,isLoading:!1,newNotificationCounter:0,errors:[]},actions:S,mutations:G,getters:{},modules:H}),V=n("TXmL"),Y={en:{failed:"Action failed",success:"Action was successful"}},B=n("LarL"),J=n.n(B),W={socketConfig:{clientId:"trackit-"+Math.random().toString(16).substr(2,8)}};-1===window.location.host.indexOf("localhost:9004")&&-1===window.location.host.indexOf("localhost:9005")&&-1===window.location.host.indexOf("localhost:7004")||(W={httpConfig:{server:"https://localhost",port:9005},socketConfig:{server:"wss://localhost:9017",clientId:"trackit-dev-"+Math.random().toString(16).substr(2,8)}});var K=n("wvfG"),U=n.n(K),Z=n("v5o6"),ee=n.n(Z);a.default.config.productionTip=!1;var te=o()({el:"#q-app",router:k,store:$},d),ne=[];ne.push(function(e){var t=e.app;e.Vue.use(V.a),t.i18n=new V.a({locale:"en",fallbackLocale:"en",messages:Y})}),ne.push(function(e){var t=e.Vue;t.config.productionTip=!1,t.use(J.a,W)}),ne.push(function(e){e.Vue.use(U.a)}),ne.forEach(function(e){return e({app:te,router:k,store:$,Vue:a.default})}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&document.addEventListener("DOMContentLoaded",function(){ee.a.attach(document.body)},!1),new a.default(te)},tHqv:function(e,t){}},[0]);