webpackJsonp([3],{"+nwc":function(e,t){},0:function(e,t,n){e.exports=n("nplA")},1:function(e,t){},2:function(e,t){},3:function(e,t){},"3Puz":function(e,t){},4:function(e,t){},"4Th3":function(e,t){},JsEP:function(e,t){},MGDR:function(e,t,n){e.exports=n.p+"img/trackit.4dbf2ed.png"},N12Q:function(e,t){},R58i:function(e,t){},nplA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Dd8w"),a=n.n(i),s=(n("30VO"),n("/5sW")),o=n("7109");s.default.use(o.T,{components:{QLayout:o.r,QLayoutDrawer:o.s,QPageContainer:o.y,QPage:o.x,QToolbar:o.L,QToolbarTitle:o.M,QBtn:o.g,QIcon:o.k,QList:o.t,QListHeader:o.u,QItem:o.m,QItemMain:o.n,QItemSide:o.o,QItemTile:o.p,QTooltip:o.N,QResizeObservable:o.C,QModal:o.v,QSelect:o.E,QInput:o.l,QKnob:o.q,QCheckbox:o.h,QModalLayout:o.w,QAlert:o.f,QTabs:o.J,QTab:o.H,QTabPane:o.I,QToggle:o.K,QPopover:o.z,QProgress:o.A,QSpinnerGears:o.G,QWindowResizeObservable:o.O,QDatetime:o.i,QSearch:o.D,QSlider:o.F,QField:o.j,QRange:o.B},directives:{TouchPan:o.Q,TouchHold:o.P},plugins:{Notify:o.e,Loading:o.c,LocalStorage:o.d,Cookies:o.a,Dialog:o.b}});n("L4dm"),n("hAPP"),n("59Iv"),n("3Puz"),n("N12Q");var c={name:"offline",data:function(){return{intervalId:0}},created:function(){var e=this;this.intervalId=setInterval(function(){e.$store.dispatch("checkConnection")},5e3)}},r=n("XyMi");var u=function(e){n("4Th3")},l={name:"App",components:{Offline:Object(r.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.$store.state.offline?n("div",{staticClass:"offline-page window-height window-width bg-light column items-center no-wrap"},[n("div",{staticClass:"offline-back"},[n("div",{staticClass:"offline-code"}),e._v(" "),n("div",{staticClass:"offline-line"},e._l(Array(20),function(t){return n("span",{key:t},[e._v("offline")])}))])]):e._e()},[],!1,u,null,null).exports}};var f=function(e){n("tHqv")},d=Object(r.a)(l,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"q-app"}},[t("router-view"),this._v(" "),t("offline",{attrs:{logo:"../statics/trackit.png"}})],1)},[],!1,f,null,null).exports,v=n("/ocq"),p=[{path:"/",component:function(){return n.e(0).then(n.bind(null,"yoYR"))},children:[{path:"devices/:devices",component:function(){return n.e(0).then(n.bind(null,"yoYR"))}}]},{path:"/login",component:function(){return n.e(1).then(n.bind(null,"P7ry"))}},{path:"/login/:token",component:function(){return n.e(1).then(n.bind(null,"P7ry"))}},{path:"/login/:token/devices/:devices",component:function(){return n.e(0).then(n.bind(null,"yoYR"))}},{path:"*",component:function(){return n.e(2).then(n.bind(null,"c5Mg"))}}];s.default.use(v.a);var h,m,g,D,k=new v.a({mode:"hash",base:"/",scrollBehavior:function(){return{y:0}},routes:p}),w=n("NYxO"),b=n("Gu7T"),Q=n.n(b),I=n("Xxa5"),y=n.n(I),x=n("exGp"),T=n.n(x),M={poolDevices:(h=T()(y.a.mark(function e(t){var n,i=this,a=t.state,o=t.commit;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o("reqStart"),e.prev=1,!a.token){e.next=7;break}return e.next=5,s.default.connector.poolDevices(function(e){o("setDevices",e)},function(e,t){o("updateDevices",{type:e,device:t})});case 5:return n=e.sent,e.abrupt("return",T()(y.a.mark(function e(){return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.connector.poolDevicesStop(n);case 2:case"end":return e.stop()}},e,i)})));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),o("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return h.apply(this,arguments)}),postMessage:(m=T()(y.a.mark(function e(t,n){t.state;var i,a,o=t.commit,c=n.data,r=n.id;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o("reqStart"),e.prev=1,e.next=4,s.default.connector.gw.postDevicesMessages(r,c);case 4:i=e.sent,a=i.data,o("reqSuccessful",{type:"postMessage",payload:a}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),o("reqFailed",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),function(e,t){return m.apply(this,arguments)}),checkConnection:(g=T()(y.a.mark(function e(t){var n=t.state,i=t.commit;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.default.connector.http.external.get("./statics/icons/favicon-16x16.png?_="+(new Date).getTime());case 3:200===e.sent.status&&n.offline&&i("setOfflineFlag",!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),n.offline||i("setOfflineFlag",!0);case 11:case"end":return e.stop()}},e,this,[[0,7]])})),function(e){return g.apply(this,arguments)}),getLastUpdatePosition:(D=T()(y.a.mark(function e(t,n){var i,a,o,c=t.state;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=n||c.activeDevicesID.join(","))){e.next=9;break}return e.next=4,s.default.connector.gw.getDevices(i,{fields:"id,telemetry"});case 4:return a=e.sent,o=Math.max.apply(Math,Q()(a.data.result.reduce(function(e,t){return e.push(t.telemetry&&t.telemetry["position.latitude"]?Math.floor(1e3*t.telemetry["position.latitude"].ts):0),e.push(t.telemetry&&t.telemetry["position.longitude"]?Math.floor(1e3*t.telemetry["position.longitude"].ts):0),e},[]))),e.abrupt("return",o-o%864e5);case 9:return e.abrupt("return",Date.now());case 10:case"end":return e.stop()}},e,this)})),function(e,t){return D.apply(this,arguments)})},P=n("woOf"),O=n.n(P),L=n("mvHQ"),S=n.n(L);function A(e,t){s.default.set(e,"offline",t)}function C(e){var t=o.a.get("X-Flespi-Token"),n=o.d.get.item("X-Flespi-Token");t&&n&&t===n&&o.a.remove("X-Flespi-Token"),o.d.remove("X-Flespi-Token"),s.default.connector.token="",s.default.set(e,"token","")}function F(e,t){e.hasDevicesInit&&!e.devices.filter(function(e){return e.id===t})[0].messages_ttl||(e.activeDevicesID.push(t),o.d.set("TrackIt Active Devices",e.activeDevicesID),e.hasDevicesInit&&k.push("/devices/"+e.activeDevicesID.join(",")))}function q(e,t){var n=e.activeDevicesID.indexOf(t);e.activeDevicesID.splice(n,1),o.d.set("TrackIt Active Devices",e.activeDevicesID),e.activeDevicesID.length?k.push("/devices/"+e.activeDevicesID.join(",")):k.push("/")}function _(e){e.hasDevicesInit=!0}function E(e){e.hasDevicesInit=!1,s.default.set(e,"devices",[]),s.default.set(e,"activeDevicesID",[])}var R={reqStart:function(e){},reqSuccessful:function(e,t){var n=t.type,i=t.payload.result;switch(n){case"postMessage":o.e.create({message:"Post message to devices with IDs "+i+" success",type:"positive",icon:"alarm_add",timeout:2500,bgColor:"white"});break;default:S()(e[n])!==S()(i)&&s.default.set(e,n,i)}},reqFailed:function(e,t){if(t.response&&t.response.status)switch(t.response.status){case 0:A(e,!0),E(e),s.default.set(e,"token","");break;case 401:C(e)}},setToken:function(e,t){var n=t.replace("FlespiToken ","");t&&n.match(/^[a-z0-9]+$/i)?(s.default.connector.token="FlespiToken "+n,o.d.set("X-Flespi-Token",n)):(n="",s.default.connector.token="",C(e)),s.default.set(e,"token",n)},clearToken:C,setActiveDevice:F,unsetActiveDevice:q,setDevicesInit:_,unsetDevicesInit:E,setOfflineFlag:A,updateDevices:function(e,t){switch(t.type){case"created":e.devices.push(t.device);break;case"updated":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices[i]=O()(e.devices[i],t.device),!0)});break;case"deleted":e.devices.some(function(n,i){return n.id===t.device.id&&(e.devices.splice(i,1),!0)})}},setDevices:function(e,t){if(S()(e.devices)!==S()(t.data.result)&&s.default.set(e,"devices",t.data.result),!e.hasDevicesInit)if(e.activeDevicesID.length)e.activeDevicesID.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length||q(e,n)}),_(e);else{_(e);var n=o.d.get.item("TrackIt Active Devices");n&&n.length&&n.forEach(function(n){t.data.result.filter(function(e){return e.id===n}).length&&F(e,n)})}}},X={messages:{namespaced:!0}};s.default.use(w.a);var j=new w.a.Store({state:{token:"",devices:[],activeDevicesID:[],hasDevicesInit:!1,offline:!1,isLoading:!1},actions:M,mutations:R,getters:{},modules:X}),z=n("TXmL"),G={en:{failed:"Action failed",success:"Action was successful"}},H=n("LarL"),N=n.n(H),V={socketConfig:{clientId:"trackit-"+Math.random().toString(16).substr(2,8)}};-1===window.location.host.indexOf("localhost:9004")&&-1===window.location.host.indexOf("localhost:9005")&&-1===window.location.host.indexOf("localhost:7004")||(V={httpConfig:{server:"https://localhost",port:9005},socketConfig:{server:"wss://localhost:9017",clientId:"trackit-dev-"+Math.random().toString(16).substr(2,8)}});var $=n("wvfG"),Y=n.n($),B=n("v5o6"),J=n.n(B);s.default.config.productionTip=!1;var K=a()({el:"#q-app",router:k,store:j},d),W=[];W.push(function(e){var t=e.app;e.Vue.use(z.a),t.i18n=new z.a({locale:"en",fallbackLocale:"en",messages:G})}),W.push(function(e){var t=e.Vue;t.config.productionTip=!1,t.use(N.a,V)}),W.push(function(e){e.Vue.use(Y.a)}),W.forEach(function(e){return e({app:K,router:k,store:j,Vue:s.default})}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&window.navigator.standalone&&document.addEventListener("DOMContentLoaded",function(){J.a.attach(document.body)},!1),new s.default(K)},tHqv:function(e,t){}},[0]);